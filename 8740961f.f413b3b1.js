(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{81:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return r})),n.d(t,"metadata",(function(){return c})),n.d(t,"toc",(function(){return s})),n.d(t,"default",(function(){return u}));var a=n(3),i=n(7),o=(n(0),n(90)),r={id:"ionio-example",title:"Ionio Account",image:"/img/marina_logo.svg"},c={unversionedId:"marina/ionio-example",id:"marina/ionio-example",isDocsHomePage:!1,title:"Ionio Account",description:"Ionio is a smart contract language that allows you to write complex taproot contracts using simple data structures and APIs.",source:"@site/docs/marina/ionio-example.md",slug:"/marina/ionio-example",permalink:"/marina/ionio-example",editUrl:"https://github.com/vulpemventures/docs.vulpem.com/edit/master/docs/docs/marina/ionio-example.md",version:"current",sidebar:"docs",previous:{title:"API reference",permalink:"/marina/api"},next:{title:"Introduction",permalink:"/nigiri/introduction"}},s=[{value:"Create an Ionio account",id:"create-an-ionio-account",children:[]},{value:"Use your Ionio account",id:"use-your-ionio-account",children:[{value:"Generate addresses from Ionio artifact",id:"generate-addresses-from-ionio-artifact",children:[]},{value:"Spend coins owned by Ionio account",id:"spend-coins-owned-by-ionio-account",children:[]}]}],l={toc:s};function u(e){var t=e.components,n=Object(i.a)(e,["components"]);return Object(o.b)("wrapper",Object(a.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,Object(o.b)("a",{parentName:"p",href:"http://ionio-lang.org/docs/intro"},"Ionio")," is a smart contract language that allows you to write complex taproot contracts using simple data structures and APIs. "),Object(o.b)("p",null,"Marina fully supports Ionio and allows you to derive taproot addresses embedding Ionio contract."),Object(o.b)("h2",{id:"create-an-ionio-account"},"Create an Ionio account"),Object(o.b)("p",null,"First of all, you need to create a Ionio account. This is a special type of account expecting an Artifact as input to derive a new address."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-js"},"import { AccountType } from 'marina-provider';\n\nawait marina.createAccount('myCustomIonioAccount', AccountType.Ionio); \n")),Object(o.b)("h2",{id:"use-your-ionio-account"},"Use your Ionio account"),Object(o.b)("p",null,"Once you created your Ionio account, you should be able to select it using ",Object(o.b)("inlineCode",{parentName:"p"},"useAccount"),"."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-js"},"await marina.useAccount('myCustomIonioAccount');\n")),Object(o.b)("h3",{id:"generate-addresses-from-ionio-artifact"},"Generate addresses from Ionio artifact"),Object(o.b)("p",null,"Ionio artifact describes the contract of the script. "),Object(o.b)("p",null,Object(o.b)("a",{parentName:"p",href:"https://github.com/louisinger/vault-calculator/blob/master/src/calculator.json"},"vault-calculator/calculator.json")," is an example of an Ionio artifact. The contract is expecting two inputs:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"sum"),' which is a number letting to "lock" my coins using a simple math problem.'),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"pubkey")," which is the public key of the signer.")),Object(o.b)("p",null,"To spend a coin locking by that script I need to provide:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"a")," and ",Object(o.b)("inlineCode",{parentName:"li"},"b")," which are the two numbers that sum up to ",Object(o.b)("inlineCode",{parentName:"li"},"sum")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"sig")," which is a schnoor signature belonging to ",Object(o.b)("inlineCode",{parentName:"li"},"pubkey"))),Object(o.b)("p",null,'Marina is able to detect the artifact inputs and inject public keys and signatures automatically. To do this, the "injected" argument must be named like the account name. Fortunately, ',Object(o.b)("inlineCode",{parentName:"p"},"@ionio-lang/ionio")," provides us some helpers:"),Object(o.b)("div",{className:"admonition admonition-tip alert alert--success"},Object(o.b)("div",{parentName:"div",className:"admonition-heading"},Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",{parentName:"h5",className:"admonition-icon"},Object(o.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},Object(o.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),Object(o.b)("div",{parentName:"div",className:"admonition-content"},Object(o.b)("p",{parentName:"div"},Object(o.b)("inlineCode",{parentName:"p"},"templateString")," is an helper function using to rename ",Object(o.b)("inlineCode",{parentName:"p"},"artifact")," arguments."))),Object(o.b)("div",{className:"admonition admonition-tip alert alert--success"},Object(o.b)("div",{parentName:"div",className:"admonition-heading"},Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",{parentName:"h5",className:"admonition-icon"},Object(o.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},Object(o.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),Object(o.b)("div",{parentName:"div",className:"admonition-content"},Object(o.b)("p",{parentName:"div"},Object(o.b)("inlineCode",{parentName:"p"},"marina.getNextAddress")," and ",Object(o.b)("inlineCode",{parentName:"p"},"marina.getNextChangeAddress")," injects artifact constructor arguments automatically if and only if the argument name is the same as the account name (and the argument type is XOnlyPublicKey)."))),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-typescript"},"import {\xa0replaceArtifactConstructorWithArguments, templateString } from '@ionio-lang/ionio';\n\n// assuming artifact is my vault-calculator `calculator.json`\nconst renamedArtifactForMarina = replaceArtifactConstructorWithArguments(\n    artifact, \n    [\n        templateString('sum'), // let's keep the same name for the sum arg\n        templateString('myCustomIonioAccount') // 'pubkey' will be replaced by the account name \n    ]\n);\n\n// once the artifact is ready, we can pass it to marina getNextAddress\nconst address = await marina.getNextAddress({\n    artifact: renamedArtifactForMarina,\n    args: {\n        // we don't need to provide the 'myCustomIonioAccount' argument, marina will inject it automatically\n        // using the next available public key of the account\n        // however, 'sum' is still required by marina in order to generate the right script\n        sum: 10\n    }    \n});\n\nconsole.log(address.confidentialAddress) // taproot address\n")),Object(o.b)("h3",{id:"spend-coins-owned-by-ionio-account"},"Spend coins owned by Ionio account"),Object(o.b)("p",null,"Get the coins owned by the Ionio account:"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-js"},"const utxos = await marina.getCoins(['myCustomIonioAccount']);\n")),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-typescript"},"import {\xa0Contract, Signer } from '@ionio-lang/ionio';\nimport { Utxo, ScriptDetails, isIonioScriptDetails, detectProvider } from 'marina-provider';\n\nconst utxo: Utxo = utxos[0];\nconst scriptDetails: ScriptDetails = utxo.scriptDetails; // utxo contains all the data of the script locking the coin\n\nif (isIonioScriptDetails(scriptDetails)) { \n    // IonioScriptDetails extends ScriptDetails and contains the artifact and the constructor parameters\n    // including the injected marina account public keys\n    const contract = new Contract(scriptDetails.artifact, scriptDetails.params);\n\n    const FEE = 280; // fixed fee amount of my transaction (in satoshis)\n\n    // our contract expect two numbers that sum up to 10\n    const a = 4;\n    const b = 6;\n    // it also needs a schnoor signature belonging to the pubkey injected by marina\n    // we need to provide a `Signer` object to the contract.\n    const marinaSigner = {\n        signTransaction: async (psetb64: string) => {\n            const marina = await detectProvider();\n            // signTransaction is a marina method that signs a pset\n            // it will fill the pset with the schnoor signature expected by the contract\n            const signed = await marina.signTransaction(psetb64);\n            return signed;\n        },\n    }\n\n    // we can now spend the coin using the contract\n    const tx = contract.from(utxo.txid, utxo.vout, utxo.witnessUtxo, {\n        asset: AssetHash.fromHex(utxo.blindingData.asset).bytesWithoutPrefix,\n        value: utxo.blindingData.value.toString(10),\n        assetBlindingFactor: Buffer.from(utxo.blindingData.assetBlindingFactor, 'hex'),\n        valueBlindingFactor: Buffer.from(utxo.blindingData.valueBlindingFactor, 'hex'),\n    })\n    .functions.transferWithSum(a, b, marinaSigner)\n    .withRecipient(recipient, amount - FEE, networks[coin.scriptDetails.network].assetHash, 0)\n    .withFeeOutput(FEE);\n\n    // unlock will fire the signTransaction method of the signer object\n    // it will open a popup asking the user to sign the transaction\n    const signerPset = await tx.unlock();\n}\n")),Object(o.b)("div",{className:"admonition admonition-tip alert alert--success"},Object(o.b)("div",{parentName:"div",className:"admonition-heading"},Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",{parentName:"h5",className:"admonition-icon"},Object(o.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},Object(o.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),Object(o.b)("div",{parentName:"div",className:"admonition-content"},Object(o.b)("p",{parentName:"div"},"More infos about how to spend an Ionio contract using the Javascript SDK: ",Object(o.b)("a",{parentName:"p",href:"http://ionio-lang.org/docs/SDK/transactions"},"http://ionio-lang.org/docs/SDK/transactions")))),Object(o.b)("p",null,"You can try and test the full example here: ",Object(o.b)("a",{parentName:"p",href:"https://github.com/louisinger/vault-calculator"},"https://github.com/louisinger/vault-calculator"),"."))}u.isMDXComponent=!0},90:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return b}));var a=n(0),i=n.n(a);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=i.a.createContext({}),u=function(e){var t=i.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},p=function(e){var t=u(e.components);return i.a.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},d=i.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,r=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),p=u(n),d=a,b=p["".concat(r,".").concat(d)]||p[d]||m[d]||o;return n?i.a.createElement(b,c(c({ref:t},l),{},{components:n})):i.a.createElement(b,c({ref:t},l))}));function b(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,r=new Array(o);r[0]=d;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:a,r[1]=c;for(var l=2;l<o;l++)r[l]=n[l];return i.a.createElement.apply(null,r)}return i.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);